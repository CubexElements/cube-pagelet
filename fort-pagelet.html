<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../fort-resource/fort-resource.html">
<link rel="import" href="./fort-pagelet-content.html">

<!--
An element to load a url into a container

Example:

    <fort-pagelet url="./ajax.html"></fort-pagelet>

Example:

    <fort-pagelet url="./random.html" refresh="3"></fort-pagelet>

@demo demo/index.html
-->

<dom-module id="fort-pagelet" attributes="auto auth url">
  <template>
    <fort-resource id="res" auto="[[auto]]" auth="[[auth]]" url="[[url]]"
                   data="{{fort-pagelet-content}}"></fort-resource>
    <fort-pagelet-content html="{{fort-pagelet-content}}">
      <slot></slot>
    </fort-pagelet-content>
  </template>

  <script>
    Polymer(
      {
        is:            'fort-pagelet',
        properties:    {
          /**
           * URL you want to be loaded into the container
           */
          url:              {type: String, notify: true},
          auth:             {type: Boolean, notify: true},
          auto:             {type: Boolean, notify: true},
          /**
           * Number of seconds to refresh the url
           */
          refresh:          {type: Number, observer: 'startInterval'},
          _refreshInterval: {type: Number}
        },
        stopInterval:  function ()
                       {
                         if(this._refreshInterval)
                         {
                           clearInterval(this._refreshInterval);
                         }
                       },
        update:        function ()
                       {
                         this.$.res.update(true);
                       },
        startInterval: function ()
                       {
                         var self = this;
                         self.stopInterval();
                         if(self.refresh)
                         {
                           this._refreshInterval = setInterval(
                             function ()
                             {
                               self.$.res.update(true);
                             },
                             self.refresh * 1000
                           );
                         }
                       },
        attached:      function () {this.startInterval()},
        detached:      function () {this.stopInterval()}
      }
    );
  </script>
</dom-module>
