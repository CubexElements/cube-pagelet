<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="./fort-pagelet-content.html">

<!--
An element to load a url into a container

Example:

    <fort-pagelet url="./ajax.html"></fort-pagelet>

Example:

    <fort-pagelet url="./random.html" refresh="3"></fort-pagelet>

@demo demo/index.html
-->

<dom-module id="fort-pagelet">
  <template>
    <iron-ajax auto url="[[url]]" handle-as="document"
               last-response="{{fort-pagelet-content}}"></iron-ajax>
    <fort-pagelet-content html="{{fort-pagelet-content}}">
      <content></content>
    </fort-pagelet-content>
  </template>

  <script>
    Polymer(
      {
        is:            'fort-pagelet',
        properties:    {
          /**
           * URL you want to be loaded into the container
           */
          url:     String,
          /**
           * Number of seconds to refresh the url
           */
          refresh: {type: Number, observer: 'startInterval'}
        },
        stopInterval:  function ()
                       {
                         if(this.refreshInterval)
                         {
                           clearInterval(this.refreshInterval);
                         }
                       },
        startInterval: function ()
                       {
                         var self = this;
                         self.stopInterval();
                         if(self.refresh)
                         {
                           this.refreshInterval = setInterval(
                             function ()
                             {
                               self.querySelector('iron-ajax')
                                   .generateRequest();
                             },
                             self.refresh * 1000
                           );
                         }
                       },
        attached:      function () {this.startInterval()},
        detached:      function () {this.stopInterval()}
      }
    );
  </script>
</dom-module>
